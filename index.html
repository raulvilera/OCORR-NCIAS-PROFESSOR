<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento de Equipamentos - E.E. Lydia Kitz Moreira</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* [MANTIDO EXATAMENTE IGUAL] */
        :root {
            --azul-escuro: #0a2463;
            --azul-medio: #3e92cc;
            --azul-claro: #d6eaff;
            --verde: #4caf50;
            --vermelho: #f44336;
            --cinza-escuro: #333;
            --cinza-claro: #f5f5f5;
            --amarelo: #FFD700;
            --laranja: #FFA500;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: var(--cinza-claro);
            color: var(--cinza-escuro);
            min-height: 100vh;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Login Page - MODIFICADO PARA O CARROSSEL */
        .login-background {
            position: relative;
            height: 100vh;
            overflow: hidden;
        }
        
        .carrossel-container {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        
        .carrossel-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        
        .carrossel-slide.active {
            opacity: 1;
        }
        
        .carrossel-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1;
        }
        
        .login-container {
            position: relative;
            z-index: 2;
            width: 90%;
            max-width: 450px;
            background: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* [RESTO DO CSS MANTIDO EXATAMENTE IGUAL] */
        .logo-text {
            font-size: 3.5rem;
            font-weight: 700;
            text-align: center;
            background: linear-gradient(to bottom, var(--azul-medio), var(--amarelo), var(--laranja));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1;
            margin: 1rem 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            color: var(--azul-escuro);
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--azul-escuro);
        }
        
        .form-group input, 
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 1rem;
            background: linear-gradient(135deg, var(--azul-claro), var(--azul-medio));
            color: white;
            box-shadow: 0 4px 15px rgba(0, 115, 230, 0.4);
            transition: all 0.3s ease;
        }
        
        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .form-group input:focus, 
        .form-group select:focus {
            outline: none;
            border: 2px solid white;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5),
                        0 4px 20px rgba(0, 115, 230, 0.6);
            background: linear-gradient(135deg, var(--azul-medio), var(--azul-escuro));
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--azul-escuro), var(--azul-medio));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 91, 181, 0.4);
            text-transform: uppercase;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 91, 181, 0.5);
        }

        /* Main App */
        #app {
            display: none;
            min-height: 100vh;
            background-color: #f0f2f5;
        }
        
        header {
            background: linear-gradient(135deg, var(--azul-escuro), var(--azul-medio));
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            margin: 20px 0 0;
            border-bottom: 2px solid var(--azul-medio);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #e6f0ff;
            border: none;
            font-weight: 500;
            color: var(--azul-escuro);
            transition: all 0.3s;
        }
        
        .tab.active {
            background: white;
            color: var(--azul-medio);
            font-weight: 600;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            min-height: 400px;
        }
        
        .tab-content.active {
            display: block;
        }

        /* Calendar */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 15px;
        }
        
        .calendar-day {
            background: white;
            border: 1px solid #ddd;
            min-height: 80px;
            padding: 5px;
            border-radius: 5px;
        }
        
        .event {
            background: var(--azul-claro);
            color: var(--azul-escuro);
            padding: 3px 5px;
            margin: 2px 0;
            border-radius: 3px;
            font-size: 0.8rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .login-container {
                padding: 1.5rem;
            }
            
            .logo-text {
                font-size: 2.5rem;
            }
            
            .tab {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .calendar {
                grid-template-columns: repeat(1, 1fr);
            }
        }

        /* Estilos adicionais para status */
        .status-pendente {
            color: #FFA500;
            font-weight: bold;
        }
        .status-aprovado {
            color: #4CAF50;
            font-weight: bold;
        }
        .status-rejeitado {
            color: #F44336;
            font-weight: bold;
        }
        .status-cancelado {
            color: #9E9E9E;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Login Page - MODIFICADO PARA INCLUIR O CARROSSEL -->
    <div class="login-background" id="login-screen">
        <!-- Carrossel de Imagens -->
        <div class="carrossel-container">
            <div class="carrossel-slide active" style="background-image: url('https://example.com/escola1.jpg')"></div>
            <div class="carrossel-slide" style="background-image: url('https://example.com/escola2.jpg')"></div>
            <div class="carrossel-slide" style="background-image: url('https://example.com/escola3.jpg')"></div>
            <div class="carrossel-slide" style="background-image: url('https://example.com/escola4.jpg')"></div>
            <div class="carrossel-overlay"></div>
        </div>
        
        <!-- Container de Login (mantido igual) -->
      <!-- Login Page -->
<div class="login-background" id="login-screen">
    <div class="login-container" style="display: flex; flex-direction: column; align-items: center;">
        <div class="logo-text">LKM</div>
        <h1 class="login-title">AGENDAMENTO DE EQUIPAMENTOS</h1>
        
        <form id="login-form" class="login-form" style="width: 100%; max-width: 350px;">
            <div class="form-group">
                <label for="email">E-mail Institucional</label>
                <input type="email" id="email" required placeholder="seu@prof.educacao.sp.gov.br">
            </div>
            <div class="form-group">
                <label for="password">Senha</label>
                <input type="password" id="password" required>
            </div>
            <button type="submit" class="btn">ACESSAR SISTEMA</button>
        </form>
    </div>
</div>


    <!-- Main App (MANTIDO EXATAMENTE IGUAL) -->
    <div id="app" class="hidden">
        <header>
            <div class="container">
                <div class="logo-text" style="font-size: 1.5rem;">AGENDAMENTO DE EQUIPAMENTOS</div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span id="user-name"></span>
                    <button class="btn" id="logout-btn" style="padding: 8px 15px;">SAIR</button>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="tabs">
                <div class="tab active" data-tab="agendamento">NOVO AGENDAMENTO</div>
                <div class="tab" data-tab="meus-agendamentos">MEUS AGENDAMENTOS</div>
                <div class="tab" data-tab="calendario">CALENDÁRIO</div>
            </div>

            <!-- Tab 1: New Schedule -->
            <div id="agendamento" class="tab-content active">
                <h2>NOVO AGENDAMENTO</h2>
                <form id="novo-agendamento-form">
                    <div class="form-group">
                        <label for="tipo-equipamento">TIPO DE EQUIPAMENTO</label>
                        <select id="tipo-equipamento" required>
                            <option value="">SELECIONE...</option>
                            <option value="Notebook">NOTEBOOK</option>
                            <option value="Chromebook">CHROMEBOOK</option>
                            <option value="Tablet">TABLET</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="quantidade">QUANTIDADE</label>
                        <input type="number" id="quantidade" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="data-agendamento">DATA</label>
                        <input type="date" id="data-agendamento" required>
                    </div>
                    <div class="form-group">
                        <label for="horario">HORÁRIO</label>
                        <select id="horario" required>
                            <option value="">SELECIONE...</option>
                            <option value="1ª aula">1ª AULA (07:00 - 07:45)</option>
                            <option value="2ª aula">2ª AULA (07:45 - 08:30)</option>
                            <option value="3ª aula">3ª AULA (08:30 - 09:15)</option>
                            <option value="4ª aula">4ª AULA (09:15 - 10:00)</option>
                            <option value="5ª aula">5ª AULA (10:00 - 10:45)</option>
                            <option value="6ª aula">6ª AULA (10:45 - 11:30)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sala">SALA</label>
                        <input type="text" id="sala" required>
                    </div>
                    <button type="submit" class="btn">AGENDAR</button>
                </form>
            </div>

            <!-- Tab 2: My Schedules -->
            <div id="meus-agendamentos" class="tab-content">
                <h2>MEUS AGENDAMENTOS</h2>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: var(--azul-medio); color: white;">
                                <th style="padding: 10px; text-align: left;">DATA</th>
                                <th style="padding: 10px; text-align: left;">EQUIPAMENTO</th>
                                <th style="padding: 10px; text-align: left;">QUANTIDADE</th>
                                <th style="padding: 10px; text-align: left;">SALA</th>
                                <th style="padding: 10px; text-align: left;">STATUS</th>
                                <th style="padding: 10px; text-align: left;">AÇÕES</th>
                            </tr>
                        </thead>
                        <tbody id="meus-agendamentos-body">
                            <!-- Dados serão carregados via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab 3: Calendar -->
            <div id="calendario" class="tab-content">
                <h2>CALENDÁRIO DE AGENDAMENTOS</h2>
                <div class="calendar" id="calendar">
                    <!-- Calendário será gerado via JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuração do sistema
        const API_BASE_URL = 'https://script.google.com/macros/s/AKfycbxeST-8IqSHrkm-SI9AddlTyo2o_GY4dpsKlD54f3NR1wHqKSmK_LnH9WtPhn-q5BEH/exec'; // Substitua pela URL do seu Apps Script

        // Elementos DOM
        const loginScreen = document.getElementById('login-screen');
        const app = document.getElementById('app');
        const loginForm = document.getElementById('login-form');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const logoutBtn = document.getElementById('logout-btn');
        const userNameSpan = document.getElementById('user-name');
        const novoAgendamentoForm = document.getElementById('novo-agendamento-form');
        const meusAgendamentosBody = document.getElementById('meus-agendamentos-body');
        const calendarEl = document.getElementById('calendar');

        // Estado da aplicação
        let currentUser = null;
        let agendamentos = [];

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            setupEventListeners();
            loadEquipmentOptions();
            initCarrossel(); // Inicializa o carrossel
        });

        // Configurar listeners de eventos
        function setupEventListeners() {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                await handleLogin();
            });
            
            logoutBtn.addEventListener('click', handleLogout);
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', switchTab);
            });
            
            if (novoAgendamentoForm) {
                novoAgendamentoForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await criarAgendamento();
                });
            }
            
            document.getElementById('data-agendamento').addEventListener('change', verificarDisponibilidadeAtual);
            document.getElementById('horario').addEventListener('change', verificarDisponibilidadeAtual);
            document.getElementById('tipo-equipamento').addEventListener('change', verificarDisponibilidadeAtual);
        }

        // ======================================
        // CÓDIGO DO CARROSSEL (NOVO)
        // ======================================
        function initCarrossel() {
            const slides = document.querySelectorAll('.carrossel-slide');
            let currentSlide = 0;
            
            function showSlide(index) {
                slides.forEach((slide, i) => {
                    slide.classList.toggle('active', i === index);
                });
            }
            
            function nextSlide() {
                currentSlide = (currentSlide + 1) % slides.length;
                showSlide(currentSlide);
            }
            
            // Iniciar transição automática (3 segundos)
            setInterval(nextSlide, 3000);
            showSlide(0); // Mostrar primeiro slide
        }

        // ======================================
        // RESTO DO JAVASCRIPT (MANTIDO IGUAL)
        // ======================================
        // Processo de login
        async function handleLogin() {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();
            
            try {
                // Validação básica do frontend
                const emailPattern = /@(prof\.educacao\.sp\.gov\.br|educacao\.sp\.gov\.br)$/;
                if (!emailPattern.test(email)) {
                    throw new Error("Por favor, use um email institucional válido (@prof.educacao.sp.gov.br ou @educacao.sp.gov.br)");
                }
                
                const response = await fetch('https://script.google.com/macros/s/AKfycbxeST-8IqSHrkm-SI9AddlTyo2o_GY4dpsKlD54f3NR1wHqKSmK_LnH9WtPhn-q5BEH/exec', {
                    method: 'POST',
                    body: JSON.stringify({ 
                        path: '/auth/login', 
                        data: { email, password } 
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Credenciais inválidas');
                }
                
                const { token, user } = await response.json();
                currentUser = { 
                    email: user.email, 
                    nome: user.nome, 
                    tipo: user.tipo,
                    token 
                };
                
                localStorage.setItem('authToken', token);
                initApp();
                
            } catch (error) {
                alert('Falha no login: ' + error.message);
            }
        }

        // Inicializar aplicação
        function initApp() {
            loginScreen.classList.add('hidden');
            app.classList.remove('hidden');
            userNameSpan.textContent = currentUser.nome;
            
            // Ajustar interface para PROATI
            if (currentUser.tipo === 'proati') {
                document.querySelector('[data-tab="calendario"]').textContent = 'APROVAR AGENDAMENTOS';
            }
            
            carregarMeusAgendamentos();
            gerarCalendario();
        }

        // Logout
        function handleLogout() {
            fetch(API_BASE_URL, {
                method: 'POST',
                body: JSON.stringify({
                    path: '/auth/logout',
                    data: { token: currentUser.token }
                })
            }).finally(() => {
                localStorage.removeItem('authToken');
                currentUser = null;
                loginScreen.classList.remove('hidden');
                app.classList.add('hidden');
                loginForm.reset();
            });
        }

        // Trocar de aba
        function switchTab(e) {
            const tab = e.currentTarget;
            const tabId = tab.getAttribute('data-tab');
            
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            tab.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            // Atualizar dados quando mudar de aba
            if (tabId === 'meus-agendamentos') {
                carregarMeusAgendamentos();
            } else if (tabId === 'calendario') {
                gerarCalendario();
            }
        }

        // Carregar opções de equipamentos
        async function loadEquipmentOptions() {
            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        path: '/equipment',
                        data: {}
                    })
                });
                
                if (!response.ok) throw new Error('Erro ao carregar equipamentos');
                
                const { equipment } = await response.json();
                const select = document.getElementById('tipo-equipamento');
                
                // Limpar opções exceto a primeira
                while (select.options.length > 1) {
                    select.remove(1);
                }
                
                // Adicionar equipamentos disponíveis
                equipment.forEach(eq => {
                    const option = document.createElement('option');
                    option.value = eq.Tipo;
                    option.textContent = eq.Tipo.toUpperCase();
                    select.appendChild(option);
                });
                
            } catch (error) {
                console.error('Erro ao carregar equipamentos:', error);
            }
        }

        // Criar novo agendamento
        async function criarAgendamento() {
            const tipoEquipamento = document.getElementById('tipo-equipamento').value;
            const quantidade = document.getElementById('quantidade').value;
            const data = document.getElementById('data-agendamento').value;
            const horario = document.getElementById('horario').value;
            const sala = document.getElementById('sala').value;
            
            try {
                // Verificar disponibilidade antes de criar
                const disponibilidade = await verificarDisponibilidade(tipoEquipamento, data, horario);
                
                if (disponibilidade.disponivel < quantidade) {
                    throw new Error(`Quantidade indisponível. Apenas ${disponibilidade.disponivel} disponíveis.`);
                }
                
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        path: '/bookings',
                        data: {
                            token: currentUser.token,
                            tipoEquipamento,
                            quantidade,
                            data,
                            horario,
                            sala
                        }
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Erro ao criar agendamento');
                }
                
                const { success, booking } = await response.json();
                alert('Agendamento criado com sucesso!');
                novoAgendamentoForm.reset();
                carregarMeusAgendamentos();
                
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        // Carregar meus agendamentos
        async function carregarMeusAgendamentos() {
            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        path: '/bookings/my',
                        data: { token: currentUser.token }
                    })
                });
                
                if (!response.ok) throw new Error('Erro ao carregar agendamentos');
                
                const { bookings } = await response.json();
                agendamentos = bookings;
                renderMeusAgendamentos();
                
            } catch (error) {
                console.error('Erro:', error);
                meusAgendamentosBody.innerHTML = `<tr><td colspan="6" style="text-align: center;">Erro ao carregar agendamentos</td></tr>`;
            }
        }

        // Renderizar meus agendamentos na tabela
        function renderMeusAgendamentos() {
            meusAgendamentosBody.innerHTML = '';
            
            if (agendamentos.length === 0) {
                meusAgendamentosBody.innerHTML = `<tr><td colspan="6" style="text-align: center;">Nenhum agendamento encontrado</td></tr>`;
                return;
            }
            
            agendamentos.forEach(ag => {
                const row = document.createElement('tr');
                
                // Formatar data
                const dataCell = document.createElement('td');
                const dataObj = new Date(ag.Data);
                dataCell.textContent = dataObj.toLocaleDateString('pt-BR');
                row.appendChild(dataCell);
                
                // Equipamento
                const equipamentoCell = document.createElement('td');
                equipamentoCell.textContent = ag.TipoEquipamento;
                row.appendChild(equipamentoCell);
                
                // Quantidade
                const quantidadeCell = document.createElement('td');
                quantidadeCell.textContent = ag.Quantidade;
                row.appendChild(quantidadeCell);
                
                // Sala
                const salaCell = document.createElement('td');
                salaCell.textContent = ag.Sala;
                row.appendChild(salaCell);
                
                // Status
                const statusCell = document.createElement('td');
                statusCell.textContent = ag.Status.toUpperCase();
                statusCell.className = `status-${ag.Status.toLowerCase()}`;
                row.appendChild(statusCell);
                
                // Ações
                const acoesCell = document.createElement('td');
                if (ag.Status === 'pendente' || ag.Status === 'aprovado') {
                    const cancelarBtn = document.createElement('button');
                    cancelarBtn.textContent = 'Cancelar';
                    cancelarBtn.className = 'btn';
                    cancelarBtn.style.padding = '5px 10px';
                    cancelarBtn.style.fontSize = '0.8rem';
                    cancelarBtn.addEventListener('click', () => cancelarAgendamento(ag.ID));
                    acoesCell.appendChild(cancelarBtn);
                }
                row.appendChild(acoesCell);
                
                meusAgendamentosBody.appendChild(row);
            });
        }

        // Cancelar agendamento
        async function cancelarAgendamento(id) {
            if (!confirm('Tem certeza que deseja cancelar este agendamento?')) return;
            
            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        path: '/bookings/cancel',
                        data: {
                            token: currentUser.token,
                            id
                        }
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Erro ao cancelar agendamento');
                }
                
                alert('Agendamento cancelado com sucesso!');
                carregarMeusAgendamentos();
                
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        // Verificar disponibilidade
        async function verificarDisponibilidade(tipoEquipamento, data, horario) {
            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        path: '/bookings/check',
                        data: { tipoEquipamento, data, horario }
                    })
                });
                
                if (!response.ok) throw new Error('Erro ao verificar disponibilidade');
                
                return await response.json();
            } catch (error) {
                console.error('Erro:', error);
                return { disponivel: 0, conflito: true };
            }
        }

        // Verificar disponibilidade com os valores atuais do formulário
        async function verificarDisponibilidadeAtual() {
            const tipoEquipamento = document.getElementById('tipo-equipamento').value;
            const data = document.getElementById('data-agendamento').value;
            const horario = document.getElementById('horario').value;
            
            if (!tipoEquipamento || !data || !horario) return;
            
            try {
                const disponibilidade = await verificarDisponibilidade(tipoEquipamento, data, horario);
                const quantidadeInput = document.getElementById('quantidade');
                
                if (disponibilidade.disponivel <= 0) {
                    quantidadeInput.setCustomValidity('Nenhum equipamento disponível neste horário');
                    alert('Nenhum equipamento disponível neste horário');
                } else {
                    quantidadeInput.setCustomValidity('');
                    quantidadeInput.max = disponibilidade.disponivel;
                    
                    if (parseInt(quantidadeInput.value) > disponibilidade.disponivel) {
                        quantidadeInput.value = disponibilidade.disponivel;
                    }
                }
                
            } catch (error) {
                console.error('Erro ao verificar disponibilidade:', error);
            }
        }

        // Gerar calendário
        function gerarCalendario() {
            // Implementação simplificada do calendário
            calendarEl.innerHTML = '';
            
            // Criar cabeçalho com dias da semana
            const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            const anoAtual = hoje.getFullYear();
            
            // Obter primeiro dia do mês e quantos dias tem o mês
            const primeiroDia = new Date(anoAtual, mesAtual, 1).getDay();
            const ultimoDia = new Date(anoAtual, mesAtual + 1, 0).getDate();
            
            // Criar dias vazios para alinhar o primeiro dia
            for (let i = 0; i < primeiroDia; i++) {
                const diaVazio = document.createElement('div');
                diaVazio.className = 'calendar-day empty';
                calendarEl.appendChild(diaVazio);
            }
            
            // Criar dias do mês
            for (let dia = 1; dia <= ultimoDia; dia++) {
                const diaElemento = document.createElement('div');
                diaElemento.className = 'calendar-day';
                
                const diaNumero = document.createElement('div');
                diaNumero.textContent = dia;
                diaElemento.appendChild(diaNumero);
                
                // Adicionar eventos (simplificado)
                const eventosDia = agendamentos.filter(ag => {
                    const dataAg = new Date(ag.Data);
                    return dataAg.getDate() === dia && 
                           dataAg.getMonth() === mesAtual && 
                           dataAg.getFullYear() === anoAtual;
                });
                
                eventosDia.forEach(ag => {
                    const evento = document.createElement('div');
                    evento.className = 'event';
                    evento.textContent = `${ag.TipoEquipamento} (${ag.Quantidade}) - ${ag.Sala}`;
                    diaElemento.appendChild(evento);
                });
                
                calendarEl.appendChild(diaElemento);
            }
        }

        // Verificar autenticação ao carregar a página
        async function checkAuth() {
            const token = localStorage.getItem('authToken');
            if (token) {
                try {
                    const response = await fetch(API_BASE_URL, {
                        method: 'POST',
                        body: JSON.stringify({
                            path: '/auth/me',
                            data: { token }
                        })
                    });
                    
                    if (response.ok) {
                        const { user } = await response.json();
                        currentUser = { 
                            email: user.email, 
                            nome: user.nome, 
                            tipo: user.tipo,
                            token 
                        };
                        initApp();
                    } else {
                        localStorage.removeItem('authToken');
                    }
                } catch (error) {
                    localStorage.removeItem('authToken');
                }
            }
        }
    </script>
</body>
</html>




